<!DOCTYPE html><h1>How to Boot Arch Linux with EFISTUB</h1> <h2 id="get-into-the-efi-shell">Get into the EFI Shell</h2>
<p>In the Arch Linux boot menu, choose <code>UEFI Shell x86_64 v2</code> to get into the EFI Shell, then press <code>ESC</code> to skip the startup.nsh</p>
<h2 id="find-the-boot-partition">Find the boot partition</h2>
<p>Issue <code>map</code> to see which partition the EFI has recognized, the partition name is something like fs0, fs1, fs2 etc</p>
<p>Use <code>ls fsX:</code> (with X is the fs# from the mapping result)</p>
<p>What youâ€™re trying to find here is the partition which contains the kernel files (/boot), it should have the <code>vmlinuz</code> and <code>initramfs</code></p>
<h2 id="add-new-boot-entry">Add new boot entry</h2>
<p>Add a new boot entry at <code>0</code> points to vmlinuz-linux (the <code>0</code> is your boot entry)</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#B392F0">bcfg</span><span style="color:#9ECBFF"> boot</span><span style="color:#9ECBFF"> add</span><span style="color:#79B8FF"> 0</span><span style="color:#9ECBFF"> fs0:</span><span style="color:#79B8FF">\v</span><span style="color:#9ECBFF">mlinuz-linux</span><span style="color:#9ECBFF"> "Arch Linux"</span></span></code></pre>
<h2 id="add-cmdline-file">Add cmdline file</h2>
<p>Create a new text file to store the cmdline for the kernel</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#B392F0">edit</span><span style="color:#9ECBFF"> fs0:</span><span style="color:#79B8FF">\c</span><span style="color:#9ECBFF">mdline.txt</span></span></code></pre>
<h2 id="add-your-necessary-kernel-cmdline-here-is-an-example">Add your necessary kernel cmdline, here is an example</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">root</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">PARTUUID=</span><span style="color:#79B8FF">0</span><span style="color:#9ECBFF">faee253-da44-9e4d-88ce-4658d8320486</span><span style="color:#B392F0"> rw</span><span style="color:#9ECBFF"> video=SVIDEO-1:d</span><span style="color:#9ECBFF"> quiet</span><span style="color:#9ECBFF"> loglevel=</span><span style="color:#79B8FF">1</span><span style="color:#9ECBFF"> vga=current</span><span style="color:#9ECBFF"> rd.udev.log_priority=</span><span style="color:#79B8FF">1</span><span style="color:#9ECBFF"> rd.systemd.show_status=</span><span style="color:#79B8FF">false</span><span style="color:#9ECBFF"> systemd.show_status=</span><span style="color:#79B8FF">false</span><span style="color:#9ECBFF"> nowatchdog</span><span style="color:#9ECBFF"> module_blacklist=iTCO_wdt</span><span style="color:#9ECBFF"> printk.devkmsg=on</span><span style="color:#9ECBFF"> i915.fastboot=</span><span style="color:#79B8FF">1</span><span style="color:#9ECBFF"> initrd=</span><span style="color:#79B8FF">\i</span><span style="color:#9ECBFF">ntel-ucode.img</span><span style="color:#9ECBFF"> initrd=</span><span style="color:#79B8FF">\i</span><span style="color:#9ECBFF">nitramfs-linux.img</span></span></code></pre>
<blockquote>
<p>Add an extra spaces at the beginning of the line in the file. There is a byte order mark at the beginning of the line that will squash any character next to it which will cause an error when booting.</p>
</blockquote>
<p>The <code>root</code> value can be the PARTUUID of your root partition, check it with <code>blkid</code> command in your linux OS</p>
<p>If you use an Intel processor, you can install the <code>intel-ucode</code> package with pacman, then you need to add an extra <code>initrd</code> before the actual linux initramfs, something like this <code>root=/dev/sdx ... initrd=\intel-ucode.img initrd=\initramfs-linux.img</code></p>
<p>Press F2 to save, F3 to exit</p>
<h2 id="add-the-cmdline-to-the-boot-entry-0">Add the cmdline to the boot entry <code>0</code></h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#B392F0">bcfg</span><span style="color:#9ECBFF"> boot</span><span style="color:#79B8FF"> -opt</span><span style="color:#79B8FF"> 0</span><span style="color:#9ECBFF"> fs0:</span><span style="color:#79B8FF">\c</span><span style="color:#9ECBFF">mdline.txt</span></span></code></pre>
<h2 id="reboot-your-machine">Reboot your machine</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#B392F0">reset</span></span></code></pre>
<p>Remove the bootable media</p>